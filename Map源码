<mxfile host="app.diagrams.net" modified="2022-12-04T04:28:12.332Z" agent="5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36 SLBrowser/8.0.0.10171 SLBChan/30" etag="zLhzWLyVkq0ADbBhLFtj" version="20.6.0" type="github">
  <diagram id="kw_veIA4uV3OFwYveZGB" name="第 1 页">
    <mxGraphModel dx="1117" dy="686" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="4681" pageHeight="3300" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="r480JZTUZfCtAWCKvELP-1" value="&lt;div&gt;static final int tableSizeFor(int cap) {&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; int n = cap - 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; n |= n &amp;gt;&amp;gt;&amp;gt; 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; n |= n &amp;gt;&amp;gt;&amp;gt; 2;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; n |= n &amp;gt;&amp;gt;&amp;gt; 4;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; n |= n &amp;gt;&amp;gt;&amp;gt; 8;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; n |= n &amp;gt;&amp;gt;&amp;gt; 16;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return (n &amp;lt; 0) ? 1 : (n &amp;gt;= 1073741824) ? 1073741824 : n + 1;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; }&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;" parent="1" vertex="1">
          <mxGeometry x="30" y="120" width="380" height="140" as="geometry" />
        </mxCell>
        <mxCell id="r480JZTUZfCtAWCKvELP-2" value="JDK8&lt;br&gt;HASHMAP" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="20" y="10" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="r480JZTUZfCtAWCKvELP-3" value="这段代码很有趣，我们默认传入都是2的幂次方，所以得出的结果就是传入的数，假如传入的不是2的幂次方他会返回一个大于该数的幂次方数；&lt;br&gt;例如 cap=65&lt;br&gt;n = 64;&lt;br&gt;0100 0000&lt;br&gt;0010 0000 右移1位&lt;br&gt;--------------------------&lt;br&gt;0110 0000 新的n&lt;br&gt;0001 1000 右移2位&lt;br&gt;--------------------------&lt;br&gt;0111 1000 新的n&lt;br&gt;0000 0111 右移4位&lt;br&gt;--------------------------&lt;br&gt;0111 1111 这就是为啥要右移1，2，4，8...位" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="280" width="390" height="250" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-2" value="resize扩容" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=2;fillWeight=2;hachureGap=8;fillColor=#f8cecc;fillStyle=dots;sketch=1;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="570" y="40" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-4" value="新旧容量和阈值设置" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-5" value="旧容量默认16&lt;br&gt;默认阈值=16*0.75=12&lt;br&gt;新容量=旧容量左移1位&lt;br&gt;新阈值=新容量*加载因子&lt;br&gt;--------------------------------&lt;br&gt;容量一定是2的幂次方&lt;br&gt;初始扩容，默认容量是16" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="860" y="100" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-6" value="遍历原table&lt;br&gt;每一个元素" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-7" value="如果对应位置只有一个元素，则将该位置元素计算新的下标放入新table中" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="540" y="350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-8" value="如果对应位置是Tree输节点" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-9" value="如果对应位置是链表" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="840" y="350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-10" value="将Tree节点以next域向下遍历" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-11" value="Node&lt;br&gt;-------------------------------&lt;br&gt;&lt;div&gt;final int hash;&lt;/div&gt;&lt;div&gt;final K key;&lt;/div&gt;&lt;div&gt;V value;&lt;/div&gt;&lt;div&gt;Node&amp;lt;K,V&amp;gt; next;&lt;/div&gt;" style="whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1100" y="135" width="160" height="100" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="_xiyFaJe4Tvk6f5m7bKA-12" target="_xiyFaJe4Tvk6f5m7bKA-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-12" value="Entry&lt;br&gt;-----------------&lt;br&gt;Entry&amp;lt;K,V&amp;gt; before&lt;br&gt;Entry&amp;lt;K,V&amp;gt; after" style="whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1340" y="155" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-14" value="extends" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1270" y="155" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="_xiyFaJe4Tvk6f5m7bKA-15" target="_xiyFaJe4Tvk6f5m7bKA-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-15" value="TreeNode&lt;br&gt;--------------&lt;br&gt;TreeNode&amp;lt;K,V&amp;gt; parent;&lt;br&gt;TreeNode&amp;lt;K,V&amp;gt; left;&lt;br&gt;TreeNode&amp;lt;K,V&amp;gt; right;&lt;br&gt;TreeNode&amp;lt;K,V&amp;gt; prev;&lt;br&gt;boolean red;" style="whiteSpace=wrap;html=1;align=left;" vertex="1" parent="1">
          <mxGeometry x="1550" y="130" width="190" height="110" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-17" value="extends" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="1470" y="155" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-18" value="将每个节点插入到&lt;br&gt;loHead和hiHead链表中" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-19" value="将loHead放入新的table原索引位置&lt;br&gt;若链表数量&amp;lt;=6 则无需再树化，否则树化" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-20" value="将hiHead放入新的table原索引+oldCap位置&lt;br&gt;若链表数量&amp;lt;=6 则无需再树化，否则树化" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="690" y="720" width="120" height="70" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-21" value="将每个节点插入到&lt;br&gt;loHead和hiHead链表中" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="840" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-22" value="将loHead放入新的table原索引位置" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="840" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_xiyFaJe4Tvk6f5m7bKA-23" value="将hiHead&lt;br&gt;放入新的table&lt;br&gt;原索引+oldCap位置" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="840" y="620" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
